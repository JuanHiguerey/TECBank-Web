const express = require("express");
const app = express();
const bodyParser = require('body-parser');
const user = require("./api/User");

app.use(bodyParser.urlencoded({extended: false}));
app.use(bodyParser.json());

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////// Modulo de Inicio //////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
app.get("/api/user/:username/:password", async (req, res) => {
    try {
        const rows = await user.Get(req.params.username, req.params.password);
        const rowsJson = JSON.parse(JSON.stringify(rows));
        const username = rowsJson[0].nombreUsuario;
        const id = rowsJson[0].idUsuario;
        console.log("User " + username + " has logged in.");
        res.status(200).json({"status": "success", "id:": id});
    }
    catch (error) {
        console.error(error);
        res.status(200).json({"status": "error"});
    }
});

app.post("/api/user/:name/:lastname/:email/:username/:password", async (req, res) => {
    try {
        const ids = await user.Create(req.params.name, req.params.lastname, req.params.email, req.params.username, req.params.password);
        console.log("User " + req.params.username + " has been registered.");
        res.status(200).json({"status": "success", "id:": ids[0]});
    }
    catch (error) {
        console.error(error);
        res.status(200).json({"status": "error"});
    }
});

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////// Modulo Principal //////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////// Modulo Informativo /////////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

app.listen(1337, () => console.log("server is running on port 1337"));